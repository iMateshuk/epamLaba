import java.text.SimpleDateFormat

plugins {

    id 'java'
}

/*ext {

    junitVersion = '5.8.1'
    springFrameworkVersion = '5.3.12'
}*/

allprojects {

    group = 'com.epam.esm'
    version = '1.0-SNAPSHOT'

    apply plugin: 'java'

    sourceCompatibility = '11'
    targetCompatibility = '11'

    tasks.withType(JavaCompile) {
        options.encoding = 'UTF-8'
    }

    repositories {
        mavenCentral()
    }

    test {
        useJUnitPlatform()

        dependsOn 'cleanTest'

        testLogging {

            events "passed", "skipped", "failed"
        }
    }

    ext.sharedManifest = manifest {

        attributes(
                'Built-By'       : System.properties['user.name'],
                'Build-Timestamp': new SimpleDateFormat("yyyy-MM-dd'T'HH:mm:ss.SSSZ").format(new Date()),
                'Created-By'     : "Gradle ${gradle.gradleVersion}",
                'Build-Jdk'      : "${System.properties['java.version']} (${System.properties['java.vendor']} ${System.properties['java.vm.version']})",
                'Build-OS'       : "${System.properties['os.name']} ${System.properties['os.arch']} ${System.properties['os.version']}",
                'Specification-Title' 	: "Gift-Certificates",
                'Specification-Version'	: "1",
                'Specification-Vendor'	: "IM, Inc.",
                'Implementation-Title'	: project.name,
                'Implementation-Version': version,
                'Implementation-Vendor'	: "IM, Inc."
        )
    }

    jar {
        manifest = project.manifest {
            from sharedManifest
        }
    }

    dependencies {
        compileOnly('javax.servlet:javax.servlet-api:4.0.1')

        testImplementation("org.junit.jupiter:junit-jupiter-api:5.8.1")
        testRuntimeOnly("org.junit.jupiter:junit-jupiter-engine:5.8.1")

        testImplementation("org.springframework:spring-test:5.3.12")
        testImplementation ("org.mockito:mockito-all:1.10.19")
        testImplementation ("org.mockito:mockito-junit-jupiter:4.0.0")

        implementation("org.springframework:spring-core:5.3.12")
        implementation("org.springframework:spring-context:5.3.12")
        implementation("org.springframework:spring-web:5.3.12")
        implementation("org.springframework:spring-webmvc:5.3.12")
        implementation("org.springframework:spring-tx:5.3.12")
        implementation("org.springframework:spring-orm:5.3.12")

    }
}

subprojects {

    task allDeps(type: DependencyReportTask) {}
}
